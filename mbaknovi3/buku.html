<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui" />
    <title>toko buku</title>
    <meta content="Admin Dashboard" name="description" />
    <meta content="Themesdesign" name="author" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- App Icons -->
    <link rel="shortcut icon" href="assets/images/favicon.ico" />

    <!-- App css -->
    <link href="assets/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="assets/css/icons.css" rel="stylesheet" type="text/css" />
    <link href="assets/css/style.css" rel="stylesheet" type="text/css" />
    <link href="assets/plugins/select2/css/select2.min.css" rel="stylesheet" type="text/css" />
    <link href="assets/plugins/sweet-alert2/sweetalert2.min.css" rel="stylesheet" type="text/css" />


    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
</head>


<body>

    <!-- Loader -->
    <script src="header.js"></script>
    <!-- End Navigation Bar-->


    <div class="wrapper">
        <div class="container-fluid">


            <div class="row">
                <div class="col-12">
                    <div class="page-title-box">

                        <h4 class="page-title">buku</h4>
                    </div>
                    <div class="card m-b-30">
                        <div class="card-body">

                            <h4 class="mt-0 header-title">Default Datatable</h4>
                            <button onclick="tampiltombol()" type="button" class="btn btn-primary waves-effect waves-light" data-toggle="modal"
                                data-target=".bs-example-modal-lg">tambah</button>
                            <table id="dttable" class="table table-bordered">
                                <thead>
                                    <tr>
                                        <th>kode buku</th>
                                        <th>judul</th>
                                        <th>pengarang</th>
                                        <th>penerbit</th>
                                        <th>isbn</th>
                                        <th>tahun terbit</th>
                                        <th>rak</th>
                                        <th>operasi</th>
                                    </tr>
                                </thead>
                            </table>

                        </div>
                    </div>
                </div>
            </div> <!-- end row -->
            <!-- end page title end breadcrumb -->
            <div class="col-sm-6 col-md-3 m-t-30">
                <div class="text-center">
                    <p class="text-muted">Large modal</p>
                    <!-- Large modal -->
                    <button type="button" class="btn btn-primary waves-effect waves-light" data-toggle="modal"
                        data-target=".bs-example-modal-lg">Large modal</button>
                </div>


                <!--  Modal content for the above example -->
                <div class="modal fade bs-example-modal-lg" role="dialog" aria-labelledby="myLargeModalLabel"
                    aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title mt-0" id="myLargeModalLabel">Large modal</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
                            </div>
                            <div class="modal-body">

                                <div class="form-group row">
                                    <label for="example-text-input" class="col-sm-2 col-form-label">judul</label>
                                    <div class="col-sm-10">
                                        <input class="form-control" type="text" id="txt_judul" />
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label for="example-text-input" class="col-sm-2 col-form-label">kode</label>
                                    <div class="col-sm-10">
                                        <input class="form-control" type="text" id="txt_kode" />
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label for="example-text-input" class="col-sm-2 col-form-label">isbn</label>
                                    <div class="col-sm-10">
                                        <input class="form-control" type="text" id="txt_isbn" />
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label for="example-text-input" class="col-sm-2 col-form-label">Tahun terbit</label>
                                    <div class="col-sm-10">
                                        <input class="form-control" type="text" id="txt_tahun" />
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label for="example-text-input" class="col-sm-2 col-form-label">rak</label>
                                    <div class="col-sm-10">
                                        <input class="form-control" type="text" id="txt_rak" />
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label for="example-text-input" class="col-sm-2 col-form-label">penerbit</label>
                                    <div class="col-sm-10">
                                        <select class="form-control select2" id="txt_penerbit"
                                            style="width:10cm"></select>
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label for="example-text-input" class="col-sm-2 col-form-label">pengarang</label>
                                    <div class="col-sm-10">
                                        <select class="form-control select2" id="txt_pengarang"
                                            style="width:10cm"></select>
                                    </div>
                                </div>
                              <div class="form-row" id="blocktombol"></div>
                            </div>
                            
                        </div><!-- /.modal-content -->
                    </div><!-- /.modal-dialog -->
                </div><!-- /.modal -->
            </div>

        </div> <!-- end container -->
    </div>
    <!-- end wrapper -->




    <script src="footer.js"></script>
    <!-- jQuery  -->
    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/js/popper.min.js"></script>
    <script src="assets/js/bootstrap.min.js"></script>
    <script src="assets/js/modernizr.min.js"></script>
    <script src="assets/js/waves.js"></script>
    <script src="assets/js/jquery.slimscroll.js"></script>
    <script src="assets/js/jquery.nicescroll.js"></script>
    <script src="assets/js/jquery.scrollTo.min.js"></script>
    <script src="assets/plugins/datatables/jquery.dataTables.min.js"></script>
    <script src="assets/plugins/datatables/dataTables.bootstrap4.min.js"></script>
    <script src="assets/plugins/datatables/dataTables.responsive.min.js"></script>
    <script src="assets/plugins/datatables/responsive.bootstrap4.min.js"></script>
    <script src="assets/plugins/select2/js/select2.min.js"></script>


    <script src="assets/plugins/sweet-alert2/sweetalert2.min.js"></script>
    <script src="assets/pages/sweet-alert.init.js"></script>

    <script src="assets/js/app.js"></script>
    <script src="alamat.js">

    </script>
    <script>
        ceklogin();
        var tbldata = $("#dttable").DataTable({
            "ajax": getbuku
        });

        function tampiltombol(){
            refresh()
            $("#blocktombol").html('<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button> <button type="button" data-dismiss="modal" class="btn btn-primary" onclick="tambah()">Save</button>');
        }
        function tambah() {
            var kode = $('#txt_kode').val();
            var judul = $('#txt_judul').val();
            var isbn = $('#txt_isbn').val();
            var terbit = $('#txt_tahun').val();
            var rak = $('#txt_rak').val();
            var penerbit = $('#txt_penerbit').val();
            var pengarang = $('#txt_pengarang').val();
            //  if (x == 1) {
                // swal({ title: 'gagal', text: 'data kosong', type: 'error' });
                // return;


            $.ajax({
                url: 'http://sihabembuns.com/mbaknovi2/api/tambahbuku',
                method: "POST",
                data: {
                    kd: kode, jd: judul, png:pengarang, pnr: penerbit, isbn:isbn, th:terbit, rak: rak
                },
                cache: "false",
                success: function (x) {
                    console.log(x);
                    if (x == 1) {
                        swal({ title: 'sukses', text: 'data buku gagal di tambahkan', type: 'success' });
                        // refresh()
                        tbldata.ajax.reload(null,false);
                    }else{
                        swal({ title: 'gagal', text: 'data buku gagal di tambahkan', type: 'error' });
                        
                    }
                }

            })
        }

       
        function hapus(a){
            // alert(a);
            swal({
                title:'hapus',
                text:'apakah anda ingin menghapus?',
                type:'warning',
                showCancelButton:true,
                confirmButtonColor:'#3085d6',
                CancelButtonColor:'#d33',
                confirmButtonText:"yes, delet it"
            }).then(function(){
                $.ajax({
                    url: 'http://sihabembuns.com/mbaknovi2/Api/hapusbuku',
                    method: "POST",
                    data:{kode2:a},
                    cache:"false",
                    success:function(x){
                        if (x == 1) {
                        swal({ title: 'berhasil', text: 'data buku berhasil di hapus', type: 'success' });
                        // refresh()
                        tbldata.ajax.reload(null,false);
                    }else{
                        swal({ title: 'gagal', text: 'data buku gagal di hapus', type: 'error' });
                        
                    }
                    }
                })
            })
        }
        $(document).ready(function () {
            $('.select2').select2();

            $.getJSON('http://sihabembuns.com/mbaknovi2/Api/pengarangJSON', function (result) {
                $.each(result, function (i, kolom) {
                    $("#txt_pengarang").append('<option value="' + kolom.ID_Pengarang + '">' + kolom.Nama_Pengarang + '</option>\
                    ');
                });
            })
            $.getJSON('http://sihabembuns.com/mbaknovi2/Api/penerbitJSON', function (result) {
                $.each(result, function (i, kolom) {
                    $("#txt_penerbit").append('<option value="' + kolom.ID_Penerbit + '">' + kolom.Nama_Penerbit + '</option>\
                    ');
                });
            })
        });
        function refresh() {
            $("#txt_kodebuku").val("");
            $("#txt_judul").val("");
            $("#txt_pengarang").val("").change();
            $("#txt_penerbit").val("").change();
            $("#txt_isbn").val("");
            $("#txt_tahunterbit").val("");
            $("#txt_rak").val("");
            $("#myLargeModalLabel").html('Tambah Data');
            $("#txt_kodebuku").attr("readonly", false);
            $("#blocktombol").html(' <button type="button" class="btn btn-secondary" data-dismiss="modal">close</button>');
        }

        function edit(el) {
            console.log(el)
            var kode= $(el).data("kode");
            console.log(kode)
            $("#txt_kodebuku").val(kode);
            $.ajax({
                url: 'http://sihabembuns.com/mbaknovi2/api/filterbuku',
                method: "POST",
                data: {kd: kode},
                cache: "false",
                success: function(x){
                    console.log(x);
                    var xx = x.split("|");
                    // console.log(xx);
                    if(xx[0] == 1){
                        $("#txt_judul").val(xx[1]);
                        $("#txt_pengarang").val(xx[2]).change();
                        $("#txt_penerbit").val(xx[3]).change();
                        $("#txt_isbn").val(xx[4]);
                        $("#txt_tahunterbit").val(xx[5]);
                        $("#txt_rak").val(xx[6]);
                    }else {
                        swal({ title: 'Gagal', text: 'Data Yang Anda Pilih Tidak Tersedia !', type: 'error' });
                        refresh();
                        tbldata.ajax.reload(null, false);
                        return;
                    }
                }
            })
            kode="'"+kode+"'"
            $("#myLargeModalLabel").html('Edit Data');
            $("#txt_kodebuku").attr("readonly", true);
            $("#blocktombol").html('<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button> <button type="button" data-dismiss="modal" class="btn btn-primary" onclick="Update('+ kode +')">Save</button>');
        }
        function Update(kode) {
            // var kode = $('#txt_kode').val();
            var judul = $('#txt_judul').val();
            var isbn = $('#txt_isbn').val();
            var terbit = $('#txt_tahun').val();
            var rak = $('#txt_rak').val();
            var penerbit = $('#txt_penerbit').val();
            var pengarang = $('#txt_pengarang').val();
            console.log(kode)
            // //  if (x == 1) {
            //     swal({ title: 'gagal', text: 'data kosong', type: 'error' });
            //     return;


            $.ajax({
                url: "http://sihabembuns.com/mbaknovi2/api/updatedata",
                method: "POST",
                data: {
                    kd: kode, jd: judul, png:pengarang, pnr: penerbit, isbn:isbn, th:terbit, rak: rak
                },
                cache: "false",
                success: function (x) {
                    console.log(x);
                    if (x == 1) {
                        swal({ title: 'sukses', text: 'data buku sukses di tambahkan', type: 'success' });
                        // refresh()
                        tbldata.ajax.reload(null,false);
                    }else{
                        swal({ title: 'gagal', text: 'data buku gagal di tambahkan', type: 'error' });
                        
                    }
                }

            })


        }

        
    </script>
    <!-- <script>
        $(function () {

            $('#tabelku').DataTable({
                "paging": true,
                "lengthChange": true,
                "searching": true,
                "ordering": true,
                "info": true,
                "autoWidth": false,
                "responsive": true,
            });
        });
    </script> -->

</body>

</html>